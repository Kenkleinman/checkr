---
title: "Checking checking"
output: html_document
runtime: shiny_prerendered
---

```{r setup, include=FALSE}
library(tutor)
library(ggplot2)
library(checkr)

# A simple checker function

# to put the info in a file
# knitr::opts_chunk$set(exercise.checker = checkr::check_info_to_file)

# to process it in the Rmd document
knitr::opts_chunk$set(exercise.checker = checkr::run_tests)
```

## Example 1

Modify the code to add two and two:

```{r, example_0, exercise = TRUE}
1 + 3
```

```{r example_0-solution}
2 + 2
```

```{r example_0-check}
test_0 <- fcall("NULL + NULL", "use addition (+)")
test_1 <- fcall("2 + NULL", "first argument should be two ")
test_2 <- fcall("NULL + 2", "second argument should also be two")
test_3 <- fcall("2 + 2", "remember to add two plus two")
USER_CODE %>% test_0 %>% test_1 %>% test_2 %>% test_3
```

## Example 2

Use R to compute the length of the hypotenuse of a right triangle with edges of length 3 and 4.

```{r example-triangle, exercise = TRUE}
# your code goes here
```

```{r example-triangle-solution}
sqrt(3^2 + 4^2)
```

```{r example-triangle-check}
test_1 <- fcall("NULL ^ 2", "need to square the lengths")
test_A <- fcall("2 ^ NULL", "you've reversed the arguments to '^'", mistake = TRUE)
test_2 <- fcall("3 ^ 2", "one of the lengths is 3")
test_3 <- fcall("4 ^ 2", "one of the lengths is 4")
test_4 <- fcall("sqrt()", "you'll have to use the square-root function to get the length.")
test_5 <- fcall("3 ^ 2 + 4 ^ 2", "remember to add the squares")
test_6 <- in_returns(c(4.99, 5.01), number, "the overall result should be 5.")
USER_CODE %>% test_A %>% test_1 %>% test_2 %>% test_3 %>% test_4 %>% test_5 %>% test_6

# NEED TO ADD MISTAKE


```

## Example 3

This is miscellaneous stuff just to illustrate code checking.  The tests will pass, as is. Modify the code to trigger fail messages.

```{r example-misc, exercise = TRUE}
x <- 7
x^2 + 1
y <- cos(x)
```

```{r example-misc-check}
test_1 <- in_names("x", "couldn't find assignment to x")
check_x <- check_value(match_number(7))
check_wrong <- check_value(match_number(7), "7 isn't what you wanted", mistake = TRUE)
USER_CODE %>% test_1 %>% check_x 
USER_CODE %>% test_1 %>% check_wrong
test_2 <- in_statements("<-")
test_3 <- in_values(50, number = TRUE)
test_2 <- fcall("cos()", "didn't see the cos() function")
test_3 <- fcall("x^2", "you didn't square x")
test_4 <- fcall("x^2 + 1", "you should have added 1 to x^2")
test_5 <- match_number(cos(7), "is the input to cos() right?")
test_6 <- match_number(50, "value should have been 50")
USER_CODE %>% test_1 -> xvalue
xvalue %>% check_value(test = function(x) {x = 7}, "should have been 7")
USER_CODE %>% test_2 %>% get_value %>% test_5
USER_CODE %>% test_3 %>% test_4 %>% get_value %>% test_6
# make sure there is a value 50 after the x <- 7 line
```

## Example 2

Fill in the code to create this plot:

```{r, echo = FALSE, out.width = "30%"}
ggplot(mtcars, aes(x = hp, y = mpg)) + 
  geom_point(aes(color = carb))
```

```{r, mtcarplot, exercise=TRUE}
ggplot(mtcars, aes( x = ___ , y = ___ )) + geom_point()
```

```{r mtcarplot-solution}
ggplot(mtcars, aes(x=hp, y = mpg)) + geom_point(aes(color = carb))
```

```{r mtcarplot-check}
test_1 <- fcall("aes(y = mpg)", message = "mpg should be the y aesthetic")
test_2 <- fcall("aes(x = hp, y = mpg)", message = "set the aesthetics via aes() to put the right variable on each axis.")
test_3 <- fcall("aes(color = carb)", "map carb to the color aethetic")
USER_CODE %>% test_1
USER_CODE %>% test_1 %>% test_2
USER_CODE %>% test_3
```

## Example 3

Use `dplyr` statements to find the mean hp of 4 cyl cars.

```{r mtcardplyr, exercise = TRUE}
mtcars %>%
  filter(cyl == 4) %>%
  summarise(mn = mean(hp))
```

```{r mtcardplyr-solution}
mtcars %>%
  filter(cyl == 4) %>%
  summarise(mn = mean(hp))
```

```{r mtcardplyr-check}
# Note that even though summarise() is used with a named argument
# we can disregard the name
test_1 <- chain_test("filter()", "use filter()",
                    "summarise(mean(hp))", "use summarise() to take mean of hp")
test_2 <- chain_test("summarise(mn = mean(hp))", "Create a variable mn in summarise")
USER_CODE %>% test_1 %>% test_2
```

## Example 4

Get the `CPS85` data from the `mosaicData` package using `data("CPS85", package = "mosaicData").
Then build a model of wage as a response, using enough explanatory variables to get $R^2 > 0.25$.
Give your model the name `my_mod`.

Note, this has already been filled in so that I can get the user code without any work.
```{r cps85r, exercise = TRUE}
data("CPS85", package = "mosaicData")
my_mod <- lm(wage ~ sector *educ + sex + married + union, data = CPS85)
```

```{r cps85r-solution}
data("CPS85", package = "mosaicData")
my_mod <- lm(wage ~ sector *educ + sex + married + union, data = CPS85)
```

```{r cps85r-check}
# Note that even though summarise() is used with a named argument
# we can disregard the name
test_1 <- chain_test("filter()", "use filter()",
                    "summarise(mean(hp))", "use summarise() to take mean of hp")
test_2 <- chain_test("summarise(mn = mean(hp))", "Create a variable mn in summarise")
USER_CODE %>% test_1 %>% test_2
```
