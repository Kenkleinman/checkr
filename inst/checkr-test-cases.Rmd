---
title: "Checking checking"
output: html_document
runtime: shiny_prerendered
---

```{r setup, include=FALSE}
library(tutor)
library(ggplot2)
library(checkr)

# A simple checker function

# to put the info in a file
# knitr::opts_chunk$set(exercise.checker = checkr::check_info_to_file)

# to process it in the Rmd document
knitr::opts_chunk$set(exercise.checker = checkr::run_tests)
```

## Example 0

Modify the code to add two and two:

```{r, example_0, exercise = TRUE}
1 + 3
```

```{r example_0-solution}
2 + 2
```

```{r example_0-check}
test_1 <- fun_test("2 + 2", "remember to add two plus two")
USER_CODE %>% test_1
```

## Example 1

This is miscellaneous stuff just to illustrate code checking.  The tests will pass, as is. Modify the code to trigger fail messages.

```{r example-1, exercise = TRUE}
x <- 7
x^2 + 1
y <- cos(x)
```

```{r example-1-check}
test_1 <- val_by_name("x", "couldn't find object 'x'.")
test_2 <- val_by_class("numeric", "no number found")
USER_CODE %>% test_1 -> xvalue
xvalue %>% check_value(test = function(x) {x = 7}, "should have been 7")
USER_CODE %>% test_2 -> numvalue
# make sure there is a value 50 after the x <- 7 line
```

## Example 2

Fill in the code to create this plot:

```{r, echo = FALSE, out.width = "30%"}
ggplot(mtcars, aes(x = hp, y = mpg)) + 
  geom_point(aes(color = carb))
```

```{r, mtcarplot, exercise=TRUE}
ggplot(mtcars, aes( x = ___ , y = ___ )) + geom_point()
```

```{r mtcarplot-solution}
ggplot(mtcars, aes(x=hp, y = mpg)) + geom_point(aes(color = carb))
```

```{r mtcarplot-check}
test_1 <- fun_test("aes(y = mpg)", message = "mpg should be the y aesthetic")
test_2 <- fun_test("aes(x = hp, y = mpg)", message = "set the aesthetics via aes() to put the right variable on each axis.")
test_3 <- fun_test("aes(color = carb)", "map carb to the color aethetic")
USER_CODE %>% test_1
USER_CODE %>% test_1 %>% test_2
USER_CODE %>% test_3
```

## Example 3

Use `dplyr` statements to find the mean hp of 4 cyl cars.

```{r mtcardplyr, exercise = TRUE}
mtcars %>%
  filter(cyl == 4) %>%
  summarise(mn = mean(hp))
```

```{r mtcardplyr-solution}
mtcars %>%
  filter(cyl == 4) %>%
  summarise(mn = mean(hp))
```

```{r mtcardplyr-check}
# Note that even though summarise() is used with a named argument
# we can disregard the name
test_1 <- chain_test("filter()", "use filter()",
                    "summarise(mean(hp))", "use summarise() to take mean of hp")
test_2 <- chain_test("summarise(mn = mean(hp))", "Create a variable mn in summarise")
USER_CODE %>% test_1 %>% test_2
```

## Example 4

Get the `CPS85` data from the `mosaicData` package using `data("CPS85", package = "mosaicData").
Then build a model of wage as a response, using enough explanatory variables to get $R^2 > 0.25$.
Give your model the name `my_mod`.

Note, this has already been filled in so that I can get the user code without any work.
```{r cps85r, exercise = TRUE}
data("CPS85", package = "mosaicData")
my_mod <- lm(wage ~ sector *educ + sex + married + union, data = CPS85)
```

```{r cps85r-solution}
data("CPS85", package = "mosaicData")
my_mod <- lm(wage ~ sector *educ + sex + married + union, data = CPS85)
```

```{r cps85r-check}
# Note that even though summarise() is used with a named argument
# we can disregard the name
test_1 <- chain_test("filter()", "use filter()",
                    "summarise(mean(hp))", "use summarise() to take mean of hp")
test_2 <- chain_test("summarise(mn = mean(hp))", "Create a variable mn in summarise")
USER_CODE %>% test_1 %>% test_2
```
